<div class="project-page">

  <div class="get-details">
    <%= link_to "Project Details" %>
    <div class="project-details">
      <p><%= @project.description %></p>
      <% @members.each do |member| %>
        <p><%= member.user.full_name %>: <%= member.role %></p>
      <% end %>

      <% if @project.user == current_user%>
        <%= link_to "Add a Member", new_project_member_path(@project) %>
      <% end %>

      <% if @project.soft_deadline.present? %>
        <p>Soft Deadline: <%= @project.soft_deadline %></p>
      <% end %>

      <p>Final Deadline: <%= @project.hard_deadline %></p>

      <%= link_to "Project Calendar" %>
    </div>
  </div>

  <div class="project-summary">
    <h1><%= @project.title %></h1>
    <p><%= @project.time_remaining %> Remaining</p>
    <p><%= @project.percentage_complete %></p>
    <h2>Activity Log</h2>

    <div id="events">
      <%= render @events %>
    </div>
  </div>

  <div class="project-tasks">
    <%= link_to "Tasks" %>
    | <%= link_to "Add Task", new_project_task_path(@project) %>
    <% if @tasks.present? %>
    <div class="tasks-list">
      <ul>
        <% @tasks.each do |task| %>
        <li>

          <p> <%= task.task_body %></p>
          <span><%= task.user.full_name %></span>
          <% if !task.complete? && (task.project.user == current_user || task.user == current_user) %>
          <%= link_to "Edit Task", edit_project_task_path(@project, task) %>
          <% end %>

          <% if task.project.user == current_user %>
          <%= link_to "Delete Task", project_task_path(@project, task), method: :delete, data: { confirm: "Are you sure you want to delete this task? This cannot be undone."} %>
          <% end %>

          <% if task.user == current_user && !task.complete? %>
          <%= link_to "Task completed?", completed_project_task_path(@project, task), method: :patch %> | <%= link_to "Pin Task", pin_task_user_path(task: task), method: :patch %>
          <% end %>

          <% if task.complete? %>
          <p>Task completed on <%= task.completed_on %></p>
          <% end %>

        </li>
        <% end %>
      </ul>
    </div>
    <% end %>
  </div>

  <div class="message-board">
    <%= link_to "Discussion" %>
    <div class="discussion">
      <% if @project.messages %>
        <% @project.messages.each do |message| %>
        <%= render 'messages/message', message: message %>
        <% end %>
      <% end %>

      <% if @project.members.where('user_id = ?', current_user.id).count > 0 %>
      <%= render 'message_form' %>
      <% end %>
    </div>
  </div>

</div>
