<div class="project-page">


  <div class="top-left details-link">
    <%= link_to "Project Details","#", :class => "detail-link" %>
  </div>

  <div class="project-details">

    <h1><%= @project.title %></h1>

    <p><%= @project.description %></p>

    <% if @project.soft_deadline.present? %>
      <p><div class="task-prop blue">
        Soft Deadline: <%= @project.soft_deadline %>
      </div></p>
    <% end %>

    <p><div class="task-prop red">
      Final Deadline | <%= @project.hard_deadline %>
    </div></p>

    <h2>Members</h2>
    <% if @project.user == current_user%>
      <%= link_to new_project_member_path(@project) do %>
        <div class="task-prop green">add member</div>
      <% end %>
    <% end %>

    <% @members.each do |member| %>

    <div class="member">
      <%= member.user.full_name %><br />
      <div class="time">
        <%= member.role %>
      </div>
    </div>

    <% end %>



    <br />
    <div title="Add to Calendar" class="addeventatc">
      Add to Calendar
      <span class="start"><%= @project.hard_deadline.strftime("%m/%d/%Y") %> 08:00 AM</span>
      <span class="end"><%= @project.hard_deadline.strftime("%m/%d/%Y") %> 10:00 AM</span>
      <span class="timezone">America/New_York</span>
      <span class="title">Mr Manager Project: <%= @project.title %></span>
      <span class="description"><%= @project.description %></span>
      <span class="alarm_reminder">10080</span>
      <span class="calname">use-title</span>
    </div>

  </div>


  <div class="project-summary">
    <span class="name"><%= @project.title %></span>
    <p><%= @project.time_remaining %> Remaining</p>
    <p><%= @project.percentage_complete %></p>


    <div class="events-container">
      <h1 class="activity-log-title">Activity Log</h1>
      <div id="events">
        <%= render @events %>
      </div>
    </div>
  </div>

  <div id="tasks-pane">
    <h1>Project Tasks</h1>
    <% if @project.members.where('user_id = ?', current_user.id).count > 0 %>
    <% end %>
    <%= render 'tasks/form', locals: {task: @task, project: @project} %>

    <% if @tasks.present? %>
      <ul class="task-list">
        <% @tasks.each do |task| %>
          <li>

            <p> <%= task.task_body %></p>
            <div class="time">
              priority: <%(task.priority).times do%><i class="material-icons" style="font-size: 0.6em; width: 1em;">star_rate</i><%end%>
            </div><br />



            <div class="task-prop white"><%= task.user.full_name %></div>
            <% if !task.complete? && (task.project.user == current_user || task.user == current_user) %>
              <%= link_to edit_project_task_path(@project, task) do %>
                <div class="task-prop green">edit</div>
              <% end %>
            <% end %>

            <% if task.project.user == current_user %>
              <%= link_to project_task_path(@project, task), method: :delete, data: { confirm: "Are you sure you want to delete this task? This cannot be undone."} do %>
                <div class="task-prop red">delete</div>
              <% end %>
            <% end %>

            <% if task.user == current_user && !task.complete? %>
              <%= link_to completed_project_task_path(@project, task), method: :patch do %>
                <div class="task-prop red">delete</div>
              <% end %>


            <%= link_to pin_task_user_path(task: task), method: :patch do %>
              <div class="task-prop blue">complete</div>
            <% end %>
            <% end %>

            <% if task.complete? %>
              <div class="task-prop blue">completed on <%= task.completed_on %></div>
            <% end %>

          </li>
        <% end %>
      </ul>
    <% end %>
  </div>

  <div class="bottom-left tasks-link"><%= link_to "Tasks" %></div>

  <div id="discussion"><%= link_to "Discussion", id: "discussion"%></div>
  <div class="discussion">
    <div class="message-board">
      <% if @messages.present? %>
      <div class="all-messages">
        <% @messages.each do |message| %>
        <%= render 'messages/message', message: message %>
        <% end %>
      </div>
      <% end %>
        <% if @project.members.where('user_id = ?', current_user.id).count > 0 %>
        <%= render 'messages/form' %>
        <% end %>
    </div>
  </div>

</div>
